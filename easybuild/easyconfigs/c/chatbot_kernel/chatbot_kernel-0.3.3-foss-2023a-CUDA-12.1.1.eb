easyblock = "PythonPackage"

name = 'chatbot_kernel'
version = '0.3.3'
versionsuffix = '-CUDA-%(cudaver)s'

homepage = 'https://github.com/appolloford/chatbot_kernel'
description = """
A Jupyter kernel to use Jupyter as a chat window, running downloaded LLMs locally.
"""

toolchain = {'name': 'foss', 'version': '2023a'}

source_urls = ['https://github.com/appolloford/chatbot_kernel/archive/refs/tags/']
sources = ['v%(version)s.tar.gz']
checksums = ['22da87a49ee66e76340b8118a69df340700f6b92adc283c5677d899069f4b340']

builddependencies = [
    ('hatchling', '1.18.0'),
]

dependencies = [
    ('CUDA', '12.1.1', '', SYSTEM),
    ('accelerate', '0.33.0', versionsuffix),
    ('bitsandbytes', '0.43.3', versionsuffix),
    ('jupyter-server', '2.7.2'),
    ('SentencePiece', '0.2.0'),
    ('Transformers', '4.39.3'),
]

download_dep_fail = True
use_pip = True
sanity_pip_check = True

postinstallcmds = ['python -m chatbot_kernel install --prefix=%(installdir)s']

sanity_check_paths = {
    'files': [],
    'dirs': ['lib', 'share'],
}

modextrapaths = {'EB_ENV_JUPYTER_ROOT': ''}

moduleclass = 'ai'
